# Nutanix GitOps Examples



## Directory Structure

```bash
.
├── env # Directory for env configs used by local scripts
│   ├── _common
│   │   └── .env.yaml # Global env configs 
│   └── ...
├── scripts # Common path for local scripts
├── clusters
│   ├── _profiles # Directory for the varying different profiles
│   │   ├── _base # Base for all cluster profiles (things installed in all variants)
│   │       └── kustomization.yaml # Kustomize ref to one or many platform _base/<service> and _components/feature
│   │   ├── management # Management cluster profile (defines management specific applications and platform variants)
│   │   └── workloads # Workloads cluster profile (defines workload specific applications and platform variants)
│   ├── nke-management-cluster # An example cluster instance generated from `_templates/management-cluster`
│   │   ├── flux-system # Generated by flux bootstrap
│   │   └── platform # generated from _templates
│   │       ├── kustomization.yaml # Maps to `management` profile above and injects secrets/config in the cluster
│   │       ├── cluster-secrets.sops.yaml
│   │       └── cluster-configs.yaml
│   ├── nke-workload-cluster-00 # An example cluster instance generated from `_templates/[prod|non-prod]-workload-cluster`
│   └── _templates # Used to generate management cluster instances with all configs/secrets needed
│       ├── management-cluster 
│       ├── prod-workload-cluster
│       └── ...
└── platform # Contains catalogue of all the platform services
    ├── cert-manager
    ├── ingress-nginx # Example service
    │   ├── _base # Base implementation of this service     
    │       ├── kustomization.yaml # Kustomize ref to ingress-nginx.yaml
    │       └── ingress-nginx.yaml # helm chart release details for ingress-nginx
    │   └── nodeport # Feature to expose nginx in a NodePort instead of in a LoadBalancer
    │       ├── kustomization.yaml # Component ref to _base and ingress-nginx-patch
    │       └── ingress-nginx-patch.yaml # patch that overrides ingress-nginx helm chart
    └── ...
```

## PreRequisites

1. `go-task`
2. `git`
3. `kubectl`
4. `karbon` kubectl plugin

## Bootstrapping

1. Deploy NKE Cluster
2. Add Node Pool

## Appendix

### Glossary

#### Infrastructure Specific

- `Cluster`: Leveraged to install a variant of the infrastructure (ie., A set of Kubernetes nodes that run containerized applications) and a set of tenants with their apps.
- `Operator`: Engineer(s) that manage and own the cluster and platform running in it.
- `Profiles`: 

#### Platform Specific

- `Platform`: A set of apps and configs installed in all clusters, and that allow operators to manage the cluster or provide features to the apps. It provides some pre-set variants that clusters can reuse.
- `Platform service`: A single service of the platform. Examples: ingress-nginx,cert-manager,kube-vip,kafka,milvus

#### Application Specific



- `App`: A single application deployment that integrates and leverages the underlying dependent platform and cluster components. It usually runs in its own namespace and is not a direct dependency on any other application.
- `Tenant`: Are commonly the engineer(s) that manage and own one or many applications.
- `Apps` Are commonly installed by `tenants` (ie., developer teams) into a specific cluster.


- `Base`: Common resources and configurations of any installation of a unit (be it an App, Cluster, Platform Service, etc.)
- `Variants`: Also known as `Component` within the `kustomize` project, are an extension of `base` with extra features. Example: ingress-nginx + kube-vip-loadbalancer.